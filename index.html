<!doctype html>
<html>

<head>
    <title>Dados sobre o Covid-19 no Brasil</title>
    <meta name="description"
        content="Atualização sobre os números de casos confirmados, reportados e mortes decorrentes do corona vírus. Os gráficos são atualizados diariamente.">
    <meta property="og:image" content="https://people.mpi-sws.org/~johnme/covid-test/images/preview.png">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1794">
    <meta property="og:image:height" content="884">
    <meta charset="utf-8">
    <script src="./utils/js/chart.js/Chart.min.js"></script>
    <script src="./utils/js/chart.js/utils.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        .chart-container-bar {
            width: 500px;
            margin-left: 40px;
            margin-right: 40px;
            margin-bottom: 40px;
        }

        .chart-container-main {
            width: 900px;
            margin-left: 40px;
            margin-right: 40px;
            margin-bottom: 40px;
        }

        .container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>

    <style type="text/css">
        /* Chart.js */
        @keyframes chartjs-render-animation {
            from {
                opacity: .99
            }

            to {
                opacity: 1
            }
        }

        .chartjs-render-monitor {
            animation: chartjs-render-animation 1ms
        }

        .chartjs-size-monitor,
        .chartjs-size-monitor-expand,
        .chartjs-size-monitor-shrink {
            position: absolute;
            direction: ltr;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
            visibility: hidden;
            z-index: -1
        }

        .chartjs-size-monitor-expand>div {
            position: absolute;
            width: 1000000px;
            height: 1000000px;
            left: 0;
            top: 0
        }

        .chartjs-size-monitor-shrink>div {
            position: absolute;
            width: 200%;
            height: 200%;
            left: 0;
            top: 0
        }
    </style>

</head>

<body>

    <div class="container">

        <div class="row text-center inline">
            <div class="col-12">
                <h1>Número de casos</h1>
            </div>
            <div class="col-12">
                <h6>Atualizado em <span id="update-datetime"></span></h6>
            </div>
            <div class="col-3">
                <h4>Mundo</h4>
                <h3><span id="confirmed-world"></span></h3>
                <h6>Ativos: <span id="active-world"></span></h6>
                <h6>Recuperados: <span id="recovered-world"></span></h6>
                <h6>Mortes: <span id="deaths-world"></span></h6>
            </div>
            <div class="col-3">
                <h4>Brasil</h4>
                <h3><span id="confirmed-brazil"></span></h3>
                <h6>Ativos: <span id="active-brazil"></span></h6>
                <h6>Recuperados: <span id="recovered-brazil"></span></h6>
                <h6>Mortes: <span id="deaths-brazil"></span></h6>
            </div>
            <div class="col-3">
                <h4>Itália</h4>
                <h3><span id="confirmed-italy"></span></h3>
                <h6>Ativos: <span id="active-italy"></span></h6>
                <h6>Recuperados: <span id="recovered-italy"></span></h6>
                <h6>Mortes: <span id="deaths-italy"></span></h6>
            </div>
            <div class="col-3">
                <h4>Alemanha</h4>
                <h3><span id="confirmed-germany"></span></h3>
                <h6>Ativos: <span id="active-germany"></span></h6>
                <h6>Recuperados: <span id="recovered-germany"></span></h6>
                <h6>Mortes: <span id="deaths-germany"></span></h6>
            </div>
        </div>

        <div class='row'>
            <div class='col chart-container-main'>
                <canvas id="canvas-days-since-fisrt-infection"></canvas>
            </div>
        </div>

        <div class="row text-center inline">
            <div class="col-12">
                <h2>Proporção de casos por país</h2>
            </div>
            <div class="col-12" id="bar-plot">
            </div>
        </div>

        <div class="row text-center inline">
            <div class="col-12">
                <h2>Número de casos por país</h2>
            </div>
            <div class="col-12">
                <h6>O eixo y possui escala diferente em cada gráfico</h6>
            </div>
        </div>
    </div>

    <script>

        var data = (function () {
            var json = null;
            $.ajax({
                'async': false,
                'global': false,
                'url': "./data/data.json",
                'dataType': "json",
                'success': function (data) {
                    json = data;
                }
            });
            return json;
        })();

        var date = Date.parse(data.last_update + ".000Z");
        date = new Date(date).toLocaleString()
        document.getElementById("update-datetime").textContent = date

        document.getElementById("confirmed-world").textContent = data.total['confirmed'].toLocaleString()
        document.getElementById("active-world").textContent = data.total['active'].toLocaleString()
        document.getElementById("recovered-world").textContent = data.total['recovered'].toLocaleString()
        document.getElementById("deaths-world").textContent = data.total['deaths'].toLocaleString()

        document.getElementById("confirmed-brazil").textContent = data.stats['Brasil']['confirmed'].toLocaleString()
        document.getElementById("active-brazil").textContent = data.stats['Brasil']['active'].toLocaleString()
        document.getElementById("recovered-brazil").textContent = data.stats['Brasil']['recovered'].toLocaleString()
        document.getElementById("deaths-brazil").textContent = data.stats['Brasil']['deaths'].toLocaleString()

        document.getElementById("confirmed-italy").textContent = data.stats['Itália']['confirmed'].toLocaleString()
        document.getElementById("active-italy").textContent = data.stats['Itália']['active'].toLocaleString()
        document.getElementById("recovered-italy").textContent = data.stats['Itália']['recovered'].toLocaleString()
        document.getElementById("deaths-italy").textContent = data.stats['Itália']['deaths'].toLocaleString()

        document.getElementById("confirmed-germany").textContent = data.stats['Alemanha']['confirmed'].toLocaleString()
        document.getElementById("active-germany").textContent = data.stats['Alemanha']['active'].toLocaleString()
        document.getElementById("recovered-germany").textContent = data.stats['Alemanha']['recovered'].toLocaleString()
        document.getElementById("deaths-germany").textContent = data.stats['Alemanha']['deaths'].toLocaleString()

        var config = {
            type: 'line',
            data: {
                labels: data.timeserie['EUA'].days_since_first_infection,
                datasets: [{
                    label: 'Brasil',
                    backgroundColor: Samples.utils.transparentize(window.chartColors.red),
                    borderColor: window.chartColors.red,
                    fill: false,
                    data: data.timeserie['Brasil'].confirmed,
                }, {
                    label: 'Alemanha',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.blue),
                    borderColor: window.chartColors.blue,
                    fill: false,
                    data: data.timeserie['Alemanha'].confirmed,
                }, {
                    label: 'EUA',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.steel_blue),
                    borderColor: window.chartColors.steel_blue,
                    fill: false,
                    data: data.timeserie['EUA'].confirmed,
                }, {
                    label: 'França',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.green),
                    borderColor: window.chartColors.green,
                    fill: false,
                    data: data.timeserie['França'].confirmed,
                }, {
                    label: 'Portugal',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.yellow),
                    borderColor: window.chartColors.yellow,
                    fill: false,
                    data: data.timeserie['Portugal'].confirmed,
                }, {
                    label: 'Itália',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.purple),
                    borderColor: window.chartColors.purple,
                    fill: false,
                    data: data.timeserie['Itália'].confirmed,
                }, {
                    label: 'Espanha',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.orange),
                    borderColor: window.chartColors.orange,
                    fill: false,
                    data: data.timeserie['Espanha'].confirmed,
                }, {
                    label: 'China',
                    ackgroundColor: Samples.utils.transparentize(window.chartColors.chocolate),
                    borderColor: window.chartColors.chocolate,
                    fill: false,
                    data: data.timeserie['China'].confirmed,
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Distribuição do número de casos a partir do primeiro caso reportado'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Número de dias desde o primeiro caso reportado',
                            fontSize: 18,
                        },
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Número oficial de casos (log)',
                            fontSize: 18,
                        },

                        type: 'logarithmic',

                        ticks: {
                            userCallback: function (tick) {
                                return tick.toLocaleString()
                            },
                            maxTicksLimit: 15,
                            //sampleSize: 15,
                        },
                    }]
                }
            }
        };

        function createConfig(country) {
            return {
                type: 'line',
                data: {
                    labels: data.timeserie[country]['date'],
                    datasets: [{
                        label: 'Confirmados',
                        backgroundColor: window.chartColors.blue,
                        borderColor: window.chartColors.blue,
                        data: data.timeserie[country]['confirmed'],
                        fill: false,
                    }, {
                        label: 'Recuperados',
                        fill: false,
                        backgroundColor: window.chartColors.green,
                        borderColor: window.chartColors.green,
                        data: data.timeserie[country]['recovered'],
                    }, {
                        label: 'Mortes',
                        fill: false,
                        backgroundColor: window.chartColors.red,
                        borderColor: window.chartColors.red,
                        data: data.timeserie[country]['deaths'],
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: country
                    },
                    scales: {
                        xAxes: [{
                            gridLines: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Número oficial de casos',
                                fontSize: 14,
                            },
                            ticks: {
                                min: 0,
                                //stepSize: 10x
                            }
                        }],
                    }
                }
            };
        }

        var barChartData = {
            labels: data.fraction['countries'],
            datasets: [{
                label: 'Ativos',
                backgroundColor: window.chartColors.blue,
                stack: 'Stack 0',
                data: data.fraction.active_frac
            }, {
                label: 'Recuperados',
                backgroundColor: window.chartColors.green,
                stack: 'Stack 0',
                data: data.fraction.recovered_frac
            }, {
                label: 'Mortes',
                backgroundColor: window.chartColors.red,
                stack: 'Stack 0',
                data: data.fraction.deaths_frac
            }]

        };

        var conf_bar = {
            type: 'line',
            data: barChartData,
            options: {
                title: {
                    display: true,
                    text: 'Proporção de casos dos 30 países mais afetados'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false
                },
                responsive: true,
                scales: {
                    xAxes: [{
                        stacked: true,
                        ticks: {
                            min: 0,
                            max: 100
                        }
                    }],
                    yAxes: [{
                        stacked: true,
                        ticks: {
                            min: 0,
                            max: 100
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Proporção (%)',
                            fontSize: 18,
                        }
                    }]
                }
            }
        }


        window.onload = function () {
            var ctx = document.getElementById('canvas-days-since-fisrt-infection').getContext('2d');
            window.myLine = new Chart(ctx, config);

            var canvas = document.createElement('canvas');
            var row = document.getElementById('bar-plot');
            row.classList.add('row');
            col = document.createElement('div')
            col.classList.add('col');
            col.classList.add('chart-container-bar');
            col.appendChild(canvas);
            row.appendChild(col)

            var ctx = canvas.getContext('2d');
            window.myBar = new Chart(ctx, conf_bar);

            var container = document.querySelector('.container');
            var row = document.createElement('div');
            row.classList.add('row');
            var c = 1;

            countries = data.fraction['countries'].slice(0)
            countries.splice(countries.indexOf('Brasil'), 1)
            countries.unshift('Brasil')
            countries.forEach(function (country) {
                col = document.createElement('div')
                col.classList.add('col');
                col.classList.add('chart-container-main');
                var canvas = document.createElement('canvas');
                col.appendChild(canvas);
                row.appendChild(col)
                var ctx = canvas.getContext('2d');
                var config = createConfig(country);
                new Chart(ctx, config);

                if (c % 2 == 0) {
                    container.appendChild(row)
                    row = document.createElement('div');
                    row.classList.add('row');
                }
                c += 1
            });
            container.appendChild(row)
        };

    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161526158-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-161526158-1');
    </script>


</body>

<!-- Footer -->
<footer>
    <div class="row text-center inline">
        <div class="w-100"></div>
        <div class="col-sm">
            <a href="http://johnnatan.me">http://johnnatan.me</a>
        </div>
    </div>

</footer>
<!-- Footer -->

</html>